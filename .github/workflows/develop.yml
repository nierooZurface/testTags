name: Changelog Generator
on:
  pull_request:
    types: [ labeled ]
    branches: 
      - "develop"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0


      - name: Print label
        run: |
          echo ${{ github.event.label.name }}

      - name: Get next version (patch)
        id: new_version_patch
        if: github.event.label.name == 'bugFix'
        uses: reecetech/version-increment@2023.10.1
        with:
          release_branch: develop
          increment: patch

      - name: Get next version (minor)
        id: new_version_minor
        if: github.event.label.name == 'feature'
        uses: reecetech/version-increment@2023.10.1
        with:
          release_branch: develop
          increment: minor

      - name: Get next version (default)
        id: new_version_default
        if: github.event.label.name != 'feature' && github.event.label.name != 'bugFix'
        uses: reecetech/version-increment@2023.10.1
        with:
          release_branch: develop
      
      - if: github.event.label.name != 'feature' && github.event.label.name != 'bugFix' 
        name: Set next version
        run: |
          echo ${{steps.new_version_default.outputs.version}}
          echo newVersion=${{steps.new_version_default.outputs.version}} >> $GITHUB_ENV

      - if: github.event.label.name == 'feature'
        name: Set next version
        run: |
          echo ${{steps.new_version_minor.outputs.version}}
          echo newVersion=${{steps.new_version_minor.outputs.version}} >> $GITHUB_ENV

      - if: github.event.label.name == 'bugFix'
        name: Set next version
        run: |
          echo ${{steps.new_version_patch.outputs.version}}
          echo newVersion=${{steps.new_version_patch.outputs.version}} >> $GITHUB_ENV

      - name: Print new version
        run: |
          echo ${{env.newVersion}}
        
      - name: Push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          custom_tag: ${{ env.newVersion}}